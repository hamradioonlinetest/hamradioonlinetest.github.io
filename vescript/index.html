<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>VE Script</title>
  <meta name="robots" content="noindex,nofollow">
  <link rel="icon" href="https://hamradioonlinetest.com/favicon.ico">
  <link rel="stylesheet" href="https://hamradioonlinetest.com/assets/css/styles.css">
  <style>
    .vescript-page {
      max-width: 760px;
      margin: 0 auto;
      padding: 48px 20px 64px;
    }

    .vescript-card {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.12);
      padding: 32px;
    }

    .vescript-card h1 {
      margin-top: 0;
    }

    .vescript-card p {
      font-size: 1.05rem;
      line-height: 1.6;
    }

    #vescript-form {
      display: grid;
      gap: 12px;
      margin-top: 16px;
    }

    #vescript-form label {
      font-weight: 600;
    }

    #vescript-form input {
      border: 1px solid #d0d0d0;
      border-radius: 8px;
      font-size: 1rem;
      padding: 10px 12px;
    }

    #vescript-form button {
      border: 0;
      border-radius: 999px;
      background: #0f4a8a;
      color: #ffffff;
      font-weight: 600;
      padding: 12px 18px;
      cursor: pointer;
      width: fit-content;
    }

    #vescript-message {
      color: #b22c2c;
      font-weight: 600;
      margin-top: 12px;
    }

    .vescript-divider {
      border: 0;
      border-top: 1px solid #d9d9d9;
      margin: 24px 0;
    }
  </style>
</head>
<body>
  <main class="vescript-page">
    <section class="vescript-card" id="vescript-gate">
      <h1>VE Script</h1>
      <p>Please enter the VE script password to continue.</p>
      <form id="vescript-form">
        <label for="vescript-password">Password</label>
        <input
          id="vescript-password"
          name="password"
          type="password"
          autocomplete="current-password"
          required
        >
        <button type="submit">Continue</button>
      </form>
      <p id="vescript-message" aria-live="polite"></p>
    </section>

    <section class="vescript-card" id="vescript-root" hidden>
      <h1>VE Script</h1>
      <p>
        Welcome to WEARC's ARRL affiliated online exam session. We are pleased to meet you and hope to provide a welcoming
        and efficient testing experience.
      </p>
      <p>How did you learn of our exam session this evening?</p>
      <hr class="vescript-divider">
      <p>The VEs on the call today are ; we are from the Northern New Jersey Area.</p>
      <p><em>Note: above is the partial script, using this just for testing at the moment.</em></p>
    </section>
  </main>

  <script>
    (function () {
      const expectedHash = "440f3890020383e375fe6e5c07621396e3a6d37c26fa9dd3f36823a4b1be7066";
      const maxAttempts = 5;
      const form = document.getElementById("vescript-form");
      const passwordInput = document.getElementById("vescript-password");
      const message = document.getElementById("vescript-message");
      let attempts = 0;

      async function hashValue(value) {
        const data = new TextEncoder().encode(value);
        const digest = await window.crypto.subtle.digest("SHA-256", data);
        return Array.from(new Uint8Array(digest))
          .map((byte) => byte.toString(16).padStart(2, "0"))
          .join("");
      }

      function failAttempt() {
        attempts += 1;
        const remaining = maxAttempts - attempts;

        if (remaining <= 0) {
          window.location.replace("/");
          return;
        }

        message.textContent = `Incorrect password. ${remaining} attempt${remaining === 1 ? "" : "s"} remaining.`;
        passwordInput.value = "";
        passwordInput.focus();
      }

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        message.textContent = "";

        const response = passwordInput.value.trim();
        if (!response) {
          message.textContent = "Please enter a password to continue.";
          return;
        }

        try {
          const hash = await hashValue(response);
          if (hash === expectedHash) {
            document.getElementById("vescript-root").hidden = false;
            document.getElementById("vescript-gate").hidden = true;
            return;
          }
        } catch (error) {
          message.textContent = "Unable to verify the password in this browser.";
          return;
        }

        failAttempt();
      });
    })();
  </script>
</body>
</html>
