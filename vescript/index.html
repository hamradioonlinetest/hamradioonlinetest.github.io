<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>VE Script</title>
  <meta name="robots" content="noindex,nofollow">
  <link rel="icon" href="https://hamradioonlinetest.com/favicon.ico">
  <link rel="stylesheet" href="https://hamradioonlinetest.com/assets/css/styles.css">
  <style>
    .vescript-page {
      max-width: 760px;
      margin: 0 auto;
      padding: 48px 20px 64px;
    }

    .vescript-card {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.12);
      padding: 32px;
    }

    .vescript-card h1 {
      margin-top: 0;
    }

    .vescript-card p {
      font-size: 1.05rem;
      line-height: 1.6;
    }

    #vescript-form {
      display: grid;
      gap: 12px;
      margin-top: 16px;
    }

    #vescript-form label {
      font-weight: 600;
    }

    #vescript-form input {
      border: 1px solid #d0d0d0;
      border-radius: 8px;
      font-size: 1rem;
      padding: 10px 12px;
    }

    #vescript-form button {
      border: 0;
      border-radius: 999px;
      background: #0f4a8a;
      color: #ffffff;
      font-weight: 600;
      padding: 12px 18px;
      cursor: pointer;
      width: fit-content;
    }

    #vescript-message {
      color: #b22c2c;
      font-weight: 600;
      margin-top: 12px;
    }

    .vescript-divider {
      border: 0;
      border-top: 1px solid #d9d9d9;
      margin: 24px 0;
    }
  </style>
</head>
<body>
  <main class="vescript-page">
    <section class="vescript-card" id="vescript-gate">
      <h1>VE Script</h1>
      <p>Please enter the VE script password to continue.</p>
      <form id="vescript-form">
        <label for="vescript-password">Password</label>
        <input
          id="vescript-password"
          name="password"
          type="password"
          autocomplete="current-password"
          required
        >
        <button type="submit">Continue</button>
      </form>
      <p id="vescript-message" aria-live="polite"></p>
    </section>

    <section class="vescript-card" id="vescript-root" hidden>
      <h1>VE Script</h1>
      <p>
        Welcome to WEARC's ARRL affiliated online exam session. We are pleased to meet you and hope to provide a welcoming
        and efficient testing experience.
      </p>
      <p>How did you learn of our exam session this evening?</p>
      <hr class="vescript-divider">
      <p>The VEs on the call today are ; we are from the Northern New Jersey Area.</p>
      <p><em>Note: above is the partial script, using this just for testing at the moment.</em></p>
    </section>
  </main>

  <script>
    (function () {
      const expectedHash = "440f3890020383e375fe6e5c07621396e3a6d37c26fa9dd3f36823a4b1be7066";
      const maxAttempts = 5;
      const form = document.getElementById("vescript-form");
      const passwordInput = document.getElementById("vescript-password");
      const message = document.getElementById("vescript-message");
      let attempts = 0;

      async function hashValue(value) {
        if (window.crypto && window.crypto.subtle) {
          const data = new TextEncoder().encode(value);
          const digest = await window.crypto.subtle.digest("SHA-256", data);
          return Array.from(new Uint8Array(digest))
            .map((byte) => byte.toString(16).padStart(2, "0"))
            .join("");
        }

        return sha256Fallback(value);
      }

      function sha256Fallback(message) {
        const utf8 = new TextEncoder().encode(message);
        const words = [];
        for (let i = 0; i < utf8.length; i += 1) {
          words[i >> 2] |= utf8[i] << ((3 - (i % 4)) * 8);
        }

        const bitLength = utf8.length * 8;
        words[bitLength >> 5] |= 0x80 << (24 - (bitLength % 32));
        words[((bitLength + 64 >> 9) << 4) + 15] = bitLength;

        const k = [
          0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1,
          0x923f82a4, 0xab1c5ed5, 0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3,
          0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174, 0xe49b69c1, 0xefbe4786,
          0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,
          0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147,
          0x06ca6351, 0x14292967, 0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13,
          0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85, 0xa2bfe8a1, 0xa81a664b,
          0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,
          0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a,
          0x5b9cca4f, 0x682e6ff3, 0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208,
          0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2
        ];

        const hash = [
          0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a,
          0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19
        ];

        for (let i = 0; i < words.length; i += 16) {
          const w = words.slice(i, i + 16);
          for (let t = 16; t < 64; t += 1) {
            const s0 = (w[t - 15] >>> 7 | w[t - 15] << 25)
              ^ (w[t - 15] >>> 18 | w[t - 15] << 14)
              ^ (w[t - 15] >>> 3);
            const s1 = (w[t - 2] >>> 17 | w[t - 2] << 15)
              ^ (w[t - 2] >>> 19 | w[t - 2] << 13)
              ^ (w[t - 2] >>> 10);
            w[t] = (w[t - 16] + s0 + w[t - 7] + s1) >>> 0;
          }

          let [a, b, c, d, e, f, g, h] = hash;
          for (let t = 0; t < 64; t += 1) {
            const s1 = (e >>> 6 | e << 26) ^ (e >>> 11 | e << 21) ^ (e >>> 25 | e << 7);
            const ch = (e & f) ^ (~e & g);
            const temp1 = (h + s1 + ch + k[t] + w[t]) >>> 0;
            const s0 = (a >>> 2 | a << 30) ^ (a >>> 13 | a << 19) ^ (a >>> 22 | a << 10);
            const maj = (a & b) ^ (a & c) ^ (b & c);
            const temp2 = (s0 + maj) >>> 0;

            h = g;
            g = f;
            f = e;
            e = (d + temp1) >>> 0;
            d = c;
            c = b;
            b = a;
            a = (temp1 + temp2) >>> 0;
          }

          hash[0] = (hash[0] + a) >>> 0;
          hash[1] = (hash[1] + b) >>> 0;
          hash[2] = (hash[2] + c) >>> 0;
          hash[3] = (hash[3] + d) >>> 0;
          hash[4] = (hash[4] + e) >>> 0;
          hash[5] = (hash[5] + f) >>> 0;
          hash[6] = (hash[6] + g) >>> 0;
          hash[7] = (hash[7] + h) >>> 0;
        }

        return hash
          .map((value) => value.toString(16).padStart(8, "0"))
          .join("");
      }

      function failAttempt() {
        attempts += 1;
        const remaining = maxAttempts - attempts;

        if (remaining <= 0) {
          window.location.replace("/");
          return;
        }

        message.textContent = `Incorrect password. ${remaining} attempt${remaining === 1 ? "" : "s"} remaining.`;
        passwordInput.value = "";
        passwordInput.focus();
      }

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        message.textContent = "";

        const response = passwordInput.value;
        if (response.trim() === "") {
          message.textContent = "Please enter a password to continue.";
          return;
        }

        try {
          const hash = await hashValue(response);
          if (hash === expectedHash) {
            document.getElementById("vescript-root").hidden = false;
            document.getElementById("vescript-gate").hidden = true;
            return;
          }
        } catch (error) {
          message.textContent = "Unable to verify the password in this browser.";
          return;
        }

        failAttempt();
      });
    })();
  </script>
</body>
</html>
